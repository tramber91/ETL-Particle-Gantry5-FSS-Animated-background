!function(){function p(){q(),s(),t(),u(),z(),v(f.offsetWidth,f.offsetHeight),w()}function q(){m=new FSS.CanvasRenderer,r(a.renderer)}function r(a){h&&g.removeChild(h.element),h=m,h.setSize(f.offsetWidth,f.offsetHeight),g.appendChild(h.element)}function s(){i=new FSS.Scene}function t(){i.remove(j),h.clear(),k=new FSS.Plane(MESH.width*h.width,MESH.height*h.height,MESH.segments,MESH.slices),l=new FSS.Material(MESH.ambient,MESH.diffuse),j=new FSS.Mesh(k,l),i.add(j);var a,b;for(a=k.vertices.length-1;a>=0;a--)b=k.vertices[a],b.anchor=FSS.Vector3.clone(b.position),b.step=FSS.Vector3.create(Math.randomInRange(.2,1),Math.randomInRange(.2,1),Math.randomInRange(.2,1)),b.time=Math.randomInRange(0,Math.PIM2)}function u(){var a,b;for(a=i.lights.length-1;a>=0;a--)b=i.lights[a],i.remove(b);for(h.clear(),a=0;a<LIGHT.count;a++)b=new FSS.Light(LIGHT.ambient,LIGHT.diffuse),b.ambientHex=b.ambient.format(),b.diffuseHex=b.diffuse.format(),i.add(b),b.mass=Math.randomInRange(.5,1),b.velocity=FSS.Vector3.create(),b.acceleration=FSS.Vector3.create(),b.force=FSS.Vector3.create(),b.ring=document.createElementNS(FSS.SVGNS,"circle"),b.ring.setAttributeNS(null,"stroke",b.ambientHex),b.ring.setAttributeNS(null,"stroke-width","0.5"),b.ring.setAttributeNS(null,"fill","none"),b.ring.setAttributeNS(null,"r","10"),b.core=document.createElementNS(FSS.SVGNS,"circle"),b.core.setAttributeNS(null,"fill",b.diffuseHex),b.core.setAttributeNS(null,"r","4")}function v(a,b){h.setSize(a,b),FSS.Vector3.set(d,h.halfWidth,h.halfHeight),t()}function w(){b=Date.now()-c,x(),y(),requestAnimationFrame(w)}function x(){var a,c,f,g,h,j,l,m=MESH.depth/2;for(FSS.Vector3.copy(LIGHT.bounds,d),FSS.Vector3.multiplyScalar(LIGHT.bounds,LIGHT.xyScalar),FSS.Vector3.setZ(e,LIGHT.zOffset),LIGHT.autopilot&&(a=Math.sin(LIGHT.step[0]*b*LIGHT.speed),c=Math.cos(LIGHT.step[1]*b*LIGHT.speed),FSS.Vector3.set(e,LIGHT.bounds[0]*a,LIGHT.bounds[1]*c,LIGHT.zOffset)),g=i.lights.length-1;g>=0;g--){h=i.lights[g],FSS.Vector3.setZ(h.position,LIGHT.zOffset);var n=Math.clamp(FSS.Vector3.distanceSquared(h.position,e),LIGHT.minDistance,LIGHT.maxDistance),o=LIGHT.gravity*h.mass/n;FSS.Vector3.subtractVectors(h.force,e,h.position),FSS.Vector3.normalise(h.force),FSS.Vector3.multiplyScalar(h.force,o),FSS.Vector3.set(h.acceleration),FSS.Vector3.add(h.acceleration,h.force),FSS.Vector3.add(h.velocity,h.acceleration),FSS.Vector3.multiplyScalar(h.velocity,LIGHT.dampening),FSS.Vector3.limit(h.velocity,LIGHT.minLimit,LIGHT.maxLimit),FSS.Vector3.add(h.position,h.velocity)}for(j=k.vertices.length-1;j>=0;j--)l=k.vertices[j],a=Math.sin(l.time+l.step[0]*b*MESH.speed),c=Math.cos(l.time+l.step[1]*b*MESH.speed),f=Math.sin(l.time+l.step[2]*b*MESH.speed),FSS.Vector3.set(l.position,MESH.xRange*k.segmentWidth*a,MESH.yRange*k.sliceHeight*c,MESH.zRange*m*f-m),FSS.Vector3.add(l.position,l.anchor);k.dirty=!0}function y(){if(h.render(i),LIGHT.draw){var a,b,c,d;for(a=i.lights.length-1;a>=0;a--)d=i.lights[a],b=d.position[0],c=d.position[1],h.context.lineWidth=.5,h.context.beginPath(),h.context.arc(b,c,10,0,Math.PIM2),h.context.strokeStyle=d.ambientHex,h.context.stroke(),h.context.beginPath(),h.context.arc(b,c,4,0,Math.PIM2),h.context.fillStyle=d.diffuseHex,h.context.fill()}}function z(){window.addEventListener("resize",B)}function B(a){v(f.offsetWidth,f.offsetHeight),y()}var b,h,i,j,k,l,m,a={renderer:"canvas"},c=Date.now(),d=FSS.Vector3.create(),e=FSS.Vector3.create(),f=document.getElementById("container"),g=document.getElementById("output");p()}();